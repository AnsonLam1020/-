<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>密室逃脫 - HTML5遊戲</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft JhengHei', 'Segoe UI', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #f0f0f0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            width: 100%;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            border-bottom: 2px solid #4cc9f0;
            width: 100%;
        }
        
        h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #4cc9f0, #4361ee);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .subtitle {
            font-size: 1.2rem;
            color: #b8b8d1;
            margin-bottom: 5px;
        }
        
        /* 關卡選擇頁面 */
        .level-selection {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            margin-top: 20px;
        }
        
        .level-selection-title {
            font-size: 2rem;
            margin-bottom: 30px;
            color: #4cc9f0;
            text-align: center;
        }
        
        .levels-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
            width: 100%;
            margin-bottom: 40px;
        }
        
        .level-card {
            background: linear-gradient(135deg, #0f3460 0%, #1a1a2e 100%);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
            transition: all 0.3s ease;
            border: 2px solid #2d4059;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }
        
        .level-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.7);
            border-color: #4cc9f0;
        }
        
        .level-icon {
            font-size: 3.5rem;
            margin-bottom: 15px;
            color: #f72585;
        }
        
        .level-name {
            font-size: 1.5rem;
            margin-bottom: 10px;
            color: #4cc9f0;
        }
        
        .level-description {
            color: #b8b8d1;
            margin-bottom: 15px;
            line-height: 1.5;
            flex-grow: 1;
        }
        
        .level-difficulty {
            margin-bottom: 20px;
        }
        
        .difficulty-stars {
            display: flex;
            gap: 5px;
        }
        
        .star {
            color: #5d5d7a;
            font-size: 1.3rem;
        }
        
        .star.filled {
            color: #ffd700;
        }
        
        .level-info {
            display: flex;
            justify-content: space-between;
            width: 100%;
            margin-top: 10px;
            font-size: 0.9rem;
            color: #72efdd;
        }
        
        .play-btn {
            padding: 12px 30px;
            background: linear-gradient(135deg, #4361ee 0%, #3a0ca3 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 10px;
            width: 100%;
            justify-content: center;
        }
        
        .play-btn:hover {
            background: linear-gradient(135deg, #4cc9f0 0%, #4361ee 100%);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 201, 240, 0.3);
        }
        
        .back-btn {
            padding: 12px 25px;
            background: linear-gradient(135deg, #5d5d7a 0%, #3a3a5e 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .back-btn:hover {
            background: linear-gradient(135deg, #6c6c8a 0%, #5d5d7a 100%);
        }
        
        /* 遊戲區域 */
        .game-area {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 30px;
            width: 100%;
        }
        
        .room-container {
            flex: 3;
            min-width: 300px;
            background-color: #0f3460;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
            position: relative;
            overflow: hidden;
        }
        
        .room-title {
            font-size: 1.5rem;
            margin-bottom: 15px;
            color: #4cc9f0;
            text-align: center;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(76, 201, 240, 0.3);
        }
        
        .room-scene {
            height: 400px;
            background-color: #1a1a2e;
            border-radius: 8px;
            position: relative;
            overflow: hidden;
            margin-bottom: 15px;
            border: 1px solid #2d4059;
        }
        
        .object {
            position: absolute;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
        }
        
        .object:hover {
            transform: scale(1.05);
        }
        
        .object i {
            font-size: 2.5rem;
            margin-bottom: 5px;
            color: #f72585;
        }
        
        .object span {
            background-color: rgba(0, 0, 0, 0.7);
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.9rem;
        }
        
        .door {
            bottom: 20px;
            right: 30px;
        }
        
        .desk {
            bottom: 20px;
            left: 30px;
        }
        
        .bookshelf {
            top: 20px;
            right: 30px;
        }
        
        .painting {
            top: 20px;
            left: 30px;
        }
        
        .safe {
            bottom: 120px;
            left: 50%;
            transform: translateX(-50%);
        }
        
        .computer {
            bottom: 120px;
            right: 120px;
        }
        
        .chest {
            bottom: 120px;
            left: 120px;
        }
        
        .controls {
            flex: 2;
            min-width: 300px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .panel {
            background-color: #0f3460;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
        }
        
        .panel-title {
            font-size: 1.3rem;
            margin-bottom: 15px;
            color: #4cc9f0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .panel-title i {
            font-size: 1.5rem;
        }
        
        .inventory {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-top: 10px;
        }
        
        .inventory-slot {
            background-color: #1a1a2e;
            border: 1px solid #2d4059;
            border-radius: 8px;
            height: 70px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .inventory-slot:hover {
            background-color: #2d4059;
            border-color: #4cc9f0;
        }
        
        .inventory-slot i {
            font-size: 1.8rem;
            margin-bottom: 5px;
            color: #f72585;
        }
        
        .inventory-slot.empty {
            border: 1px dashed #2d4059;
            color: #5d5d7a;
        }
        
        .inventory-slot.empty i {
            color: #5d5d7a;
        }
        
        .message-log {
            height: 200px;
            overflow-y: auto;
            background-color: #1a1a2e;
            border-radius: 8px;
            padding: 15px;
            border: 1px solid #2d4059;
        }
        
        .message {
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(45, 64, 89, 0.5);
            line-height: 1.5;
        }
        
        .message:last-child {
            margin-bottom: 0;
            border-bottom: none;
        }
        
        .message.system {
            color: #4cc9f0;
            font-style: italic;
        }
        
        .message.item {
            color: #f72585;
        }
        
        .message.puzzle {
            color: #72efdd;
        }
        
        .action-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }
        
        .btn {
            padding: 12px 20px;
            background: linear-gradient(135deg, #4361ee 0%, #3a0ca3 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            flex: 1;
            min-width: 140px;
        }
        
        .btn:hover {
            background: linear-gradient(135deg, #4cc9f0 0%, #4361ee 100%);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 201, 240, 0.3);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn-escape {
            background: linear-gradient(135deg, #f72585 0%, #b5179e 100%);
        }
        
        .btn-escape:hover {
            background: linear-gradient(135deg, #ff4da6 0%, #f72585 100%);
        }
        
        .puzzle-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: linear-gradient(135deg, #0f3460 0%, #1a1a2e 100%);
            width: 90%;
            max-width: 500px;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.7);
            border: 1px solid #4cc9f0;
        }
        
        .modal-title {
            font-size: 1.5rem;
            margin-bottom: 15px;
            color: #4cc9f0;
            text-align: center;
        }
        
        .puzzle-instruction {
            margin-bottom: 20px;
            line-height: 1.6;
            color: #b8b8d1;
        }
        
        .puzzle-input {
            width: 100%;
            padding: 12px;
            background-color: #1a1a2e;
            border: 1px solid #2d4059;
            border-radius: 8px;
            color: white;
            font-size: 1.1rem;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .puzzle-input:focus {
            outline: none;
            border-color: #4cc9f0;
        }
        
        .modal-buttons {
            display: flex;
            gap: 10px;
        }
        
        .modal-btn {
            flex: 1;
            padding: 12px;
            border-radius: 8px;
            border: none;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .modal-btn.submit {
            background-color: #4361ee;
            color: white;
        }
        
        .modal-btn.submit:hover {
            background-color: #4cc9f0;
        }
        
        .modal-btn.cancel {
            background-color: #5d5d7a;
            color: white;
        }
        
        .modal-btn.cancel:hover {
            background-color: #6c6c8a;
        }
        
        .hint-system {
            margin-top: 20px;
            padding: 15px;
            background-color: rgba(26, 26, 46, 0.7);
            border-radius: 8px;
            border-left: 4px solid #f72585;
        }
        
        .hint-title {
            font-size: 1.1rem;
            margin-bottom: 10px;
            color: #f72585;
        }
        
        .hint-text {
            color: #b8b8d1;
            line-height: 1.5;
        }
        
        .game-status {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #0f3460;
            padding: 15px;
            border-radius: 12px;
            margin-top: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .status-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }
        
        .status-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #4cc9f0;
        }
        
        .status-label {
            font-size: 0.9rem;
            color: #b8b8d1;
        }
        
        .escape-message {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.95);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            text-align: center;
        }
        
        .escape-content {
            background: linear-gradient(135deg, #0f3460 0%, #1a1a2e 100%);
            width: 90%;
            max-width: 600px;
            border-radius: 12px;
            padding: 40px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.8);
            border: 2px solid #4cc9f0;
        }
        
        .escape-title {
            font-size: 2.5rem;
            margin-bottom: 20px;
            color: #f72585;
        }
        
        .escape-text {
            font-size: 1.2rem;
            line-height: 1.6;
            margin-bottom: 30px;
            color: #b8b8d1;
        }
        
        .restart-btn {
            padding: 15px 40px;
            background: linear-gradient(135deg, #f72585 0%, #b5179e 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.2rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .restart-btn:hover {
            background: linear-gradient(135deg, #ff4da6 0%, #f72585 100%);
            transform: scale(1.05);
        }
        
        /* 頁面切換 */
        .page {
            display: none;
            width: 100%;
        }
        
        .page.active {
            display: block;
        }
        
        @media (max-width: 768px) {
            .game-area {
                flex-direction: column;
            }
            
            .inventory {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .object {
                transform: scale(0.9);
            }
            
            .object:hover {
                transform: scale(0.95);
            }
            
            h1 {
                font-size: 2.2rem;
            }
            
            .levels-container {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }
        }
        
        @media (max-width: 480px) {
            .inventory {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .btn {
                min-width: 100%;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            .levels-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-door-closed"></i> 密室逃脫</h1>
            <p class="subtitle">你被困在神祕的房間中，尋找線索，解開謎題，找到出口逃離！</p>
        </header>
        
        <!-- 關卡選擇頁面 -->
        <div class="page active" id="levelSelectPage">
            <div class="level-selection">
                <h2 class="level-selection-title">選擇一個關卡開始遊戲</h2>
                
                <div class="levels-container" id="levelsContainer">
                    <!-- 關卡卡片將通過JavaScript動態添加 -->
                </div>
                
                <div class="subtitle">
                    每個關卡都有不同的主題和難度，挑戰自己的解謎能力吧！
                </div>
            </div>
        </div>
        
        <!-- 遊戲頁面 -->
        <div class="page" id="gamePage">
            <button class="back-btn" id="backToLevelsBtn">
                <i class="fas fa-arrow-left"></i> 返回關卡選擇
            </button>
            
            <div class="game-area">
                <div class="room-container">
                    <h2 class="room-title" id="roomTitle">書房密室</h2>
                    <div class="room-scene" id="roomScene">
                        <!-- 房間中的物品將通過JavaScript動態添加 -->
                    </div>
                    
                    <div class="hint-system">
                        <div class="hint-title"><i class="fas fa-lightbulb"></i> 遊戲提示</div>
                        <div class="hint-text" id="hintText">點擊房間中的物品進行探索。首先檢查書桌，你可能會找到有用的物品。</div>
                    </div>
                </div>
                
                <div class="controls">
                    <div class="panel">
                        <h3 class="panel-title"><i class="fas fa-backpack"></i> 物品欄</h3>
                        <div class="inventory" id="inventory">
                            <!-- 物品欄將通過JavaScript動態添加 -->
                        </div>
                    </div>
                    
                    <div class="panel">
                        <h3 class="panel-title"><i class="fas fa-comment-alt"></i> 訊息紀錄</h3>
                        <div class="message-log" id="messageLog">
                            <!-- 訊息將通過JavaScript動態添加 -->
                        </div>
                        
                        <div class="action-buttons">
                            <button class="btn" id="hintBtn">
                                <i class="fas fa-question-circle"></i> 請求提示
                            </button>
                            <button class="btn" id="examineBtn">
                                <i class="fas fa-search"></i> 檢查房間
                            </button>
                            <button class="btn btn-escape" id="escapeBtn">
                                <i class="fas fa-door-open"></i> 嘗試逃脫
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="game-status">
                <div class="status-item">
                    <div class="status-value" id="puzzlesSolved">0/4</div>
                    <div class="status-label">已解謎題</div>
                </div>
                <div class="status-item">
                    <div class="status-value" id="itemsFound">0/6</div>
                    <div class="status-label">找到物品</div>
                </div>
                <div class="status-item">
                    <div class="status-value" id="timeSpent">0:00</div>
                    <div class="status-label">用時</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 謎題模態框 -->
    <div class="puzzle-modal" id="puzzleModal">
        <div class="modal-content">
            <h3 class="modal-title" id="puzzleTitle">書桌抽屜密碼鎖</h3>
            <p class="puzzle-instruction" id="puzzleInstruction">這個抽屜被一個四位數密碼鎖鎖住了。或許在房間某處可以找到密碼提示。</p>
            <input type="text" class="puzzle-input" id="puzzleInput" placeholder="輸入密碼..." maxlength="4">
            <div class="modal-buttons">
                <button class="modal-btn submit" id="submitPuzzle">提交</button>
                <button class="modal-btn cancel" id="cancelPuzzle">取消</button>
            </div>
        </div>
    </div>
    
    <!-- 逃脫成功訊息 -->
    <div class="escape-message" id="escapeMessage">
        <div class="escape-content">
            <h2 class="escape-title"><i class="fas fa-trophy"></i> 恭喜逃脫成功！</h2>
            <div class="escape-text">
                <p>你成功解開了所有謎題並逃離了神祕房間！</p>
                <p>關卡: <span id="finalLevel">書房密室</span></p>
                <p>難度: <span id="finalDifficulty">★☆☆☆☆</span></p>
                <p>用時: <span id="finalTime">0:00</span></p>
                <p>找到物品: <span id="finalItems">0</span> 個</p>
                <p>解開謎題: <span id="finalPuzzles">0</span> 個</p>
                <p>使用提示: <span id="finalHints">0</span> 次</p>
            </div>
            <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                <button class="restart-btn" id="restartBtn"><i class="fas fa-redo"></i> 重玩本關</button>
                <button class="restart-btn" id="nextLevelBtn"><i class="fas fa-arrow-right"></i> 下一關</button>
                <button class="restart-btn" id="backToLevelsAfterWinBtn"><i class="fas fa-list"></i> 關卡選擇</button>
            </div>
        </div>
    </div>
    
    <script>
        // 遊戲狀態變數
        let gameState = {
            currentLevel: 1,
            inventory: [],
            puzzlesSolved: 0,
            itemsFound: 0,
            timeSpent: 0,
            hintsUsed: 0,
            currentPuzzle: null,
            gameActive: true,
            timerInterval: null
        };
        
        // 關卡定義 - 現在有6個關卡，難度各不相同
        const levels = {
            1: {
                id: 1,
                name: "書房密室",
                description: "一個充滿書籍和古老物品的書房，適合新手挑戰",
                difficulty: 1, // 1-5星
                icon: "fas fa-home",
                itemsCount: 6,
                puzzlesCount: 4,
                items: {
                    key: { id: 'key', name: '銅鑰匙', icon: 'fas fa-key', description: '一把古老的銅鑰匙，看起來可以用來開鎖。', found: false },
                    note: { id: 'note', name: '神秘紙條', icon: 'fas fa-scroll', description: '一張泛黃的紙條，上面寫著: "密碼在書的排列中"', found: false },
                    flashlight: { id: 'flashlight', name: '手電筒', icon: 'fas fa-flashlight', description: '一個還能用的手電筒，也許可以用來照亮黑暗的角落。', found: false },
                    screwdriver: { id: 'screwdriver', name: '螺絲起子', icon: 'fas fa-screwdriver', description: '一把小螺絲起子，可以用來鬆開螺絲。', found: false },
                    book: { id: 'book', name: '舊書', icon: 'fas fa-book', description: '一本舊書，書名是"逃脫的藝術"。', found: false },
                    codePaper: { id: 'codePaper', name: '密碼紙', icon: 'fas fa-file-code', description: '一張寫著數字"7283"的紙條。', found: false }
                },
                puzzles: {
                    deskDrawer: {
                        id: 'deskDrawer',
                        name: '書桌抽屜密碼鎖',
                        instruction: '這個抽屜被一個四位數密碼鎖鎖住了。或許在房間某處可以找到密碼提示。',
                        answer: '7283',
                        solved: false,
                        hint: '檢查書架上的書，看看它們的排列順序有沒有規律。'
                    },
                    safe: {
                        id: 'safe',
                        name: '保險箱謎題',
                        instruction: '保險箱需要輸入正確的密碼才能打開。密碼隱藏在畫作中。',
                        answer: '1947',
                        solved: false,
                        hint: '仔細查看畫作中的細節，特別是羅馬數字。'
                    },
                    bookshelf: {
                        id: 'bookshelf',
                        name: '書架機關',
                        instruction: '書架似乎有一個隱藏的機關。你需要找到正確的書來觸發它。',
                        answer: 'ESCAPE',
                        solved: false,
                        hint: '查看書架上的書名首字母，試著拼出一個單詞。'
                    },
                    door: {
                        id: 'door',
                        name: '門鎖',
                        instruction: '門被一個複雜的鎖鎖住了，需要鑰匙和密碼才能打開。',
                        answer: 'FINAL',
                        solved: false,
                        hint: '你需要找到鑰匙並解決其他所有謎題才能打開這扇門。'
                    }
                },
                roomObjects: [
                    { id: 'desk', name: '書桌', icon: 'fas fa-table', x: 'desk', puzzle: 'deskDrawer' },
                    { id: 'bookshelf', name: '書架', icon: 'fas fa-book-open', x: 'bookshelf', puzzle: 'bookshelf' },
                    { id: 'painting', name: '畫作', icon: 'fas fa-image', x: 'painting', puzzle: 'safe' },
                    { id: 'safe', name: '保險箱', icon: 'fas fa-vault', x: 'safe', puzzle: 'safe' },
                    { id: 'door', name: '門', icon: 'fas fa-door-closed', x: 'door', puzzle: 'door' }
                ],
                initialMessages: [
                    "你醒來發現自己被困在一個神祕的書房中。",
                    "房間裡有一扇門，但被鎖住了。",
                    "你需要尋找線索和物品來解開謎題並逃脫。"
                ]
            },
            2: {
                id: 2,
                name: "實驗室密室",
                description: "一個充滿科學儀器和化學藥品的實驗室，需要邏輯思維",
                difficulty: 2,
                icon: "fas fa-flask",
                itemsCount: 6,
                puzzlesCount: 4,
                items: {
                    keycard: { id: 'keycard', name: '門禁卡', icon: 'fas fa-id-card', description: '一張電子門禁卡，可以用來打開電子鎖。', found: false },
                    chemicalNote: { id: 'chemicalNote', name: '化學方程式', icon: 'fas fa-vial', description: '一張寫著化學方程式的紙條：H2 + O2 → H2O', found: false },
                    usb: { id: 'usb', name: 'USB隨身碟', icon: 'fas fa-usb', description: '一個USB隨身碟，裡面可能存有重要資料。', found: false },
                    magnet: { id: 'magnet', name: '強力磁鐵', icon: 'fas fa-magnet', description: '一個強力磁鐵，可以用來吸引金屬物品。', found: false },
                    beaker: { id: 'beaker', name: '燒杯', icon: 'fas fa-flask', description: '一個裝有藍色液體的燒杯。', found: false },
                    codeNote: { id: 'codeNote', name: '數字紙條', icon: 'fas fa-file-alt', description: '一張寫著數字"4628"的紙條。', found: false }
                },
                puzzles: {
                    computer: {
                        id: 'computer',
                        name: '電腦密碼',
                        instruction: '電腦被密碼鎖住了。提示：化學方程式中的原子數量。',
                        answer: '242',
                        solved: false,
                        hint: 'H2 + O2 → H2O，計算每種原子的數量。'
                    },
                    chemicalLock: {
                        id: 'chemicalLock',
                        name: '化學藥櫃鎖',
                        instruction: '藥櫃需要輸入正確的化學符號組合才能打開。',
                        answer: 'H2O',
                        solved: false,
                        hint: '想一想最常見的化學物質是什麼？'
                    },
                    magnetPuzzle: {
                        id: 'magnetPuzzle',
                        name: '磁性機關',
                        instruction: '這個機關需要使用磁鐵來觸發。',
                        answer: 'MAGNET',
                        solved: false,
                        hint: '將磁鐵放在正確的位置上。'
                    },
                    door: {
                        id: 'door',
                        name: '實驗室門鎖',
                        instruction: '實驗室的門需要門禁卡和密碼才能打開。',
                        answer: '4628',
                        solved: false,
                        hint: '你找到的數字紙條可能有用。'
                    }
                },
                roomObjects: [
                    { id: 'computer', name: '電腦', icon: 'fas fa-desktop', x: 'computer', puzzle: 'computer' },
                    { id: 'chemicalCabinet', name: '化學藥櫃', icon: 'fas fa-prescription-bottle', x: 'chest', puzzle: 'chemicalLock' },
                    { id: 'whiteboard', name: '白板', icon: 'fas fa-chalkboard', x: 'painting', puzzle: null },
                    { id: 'magneticPanel', name: '磁性面板', icon: 'fas fa-th-large', x: 'safe', puzzle: 'magnetPuzzle' },
                    { id: 'door', name: '實驗室門', icon: 'fas fa-door-closed', x: 'door', puzzle: 'door' }
                ],
                initialMessages: [
                    "你被困在一個神祕的實驗室中。",
                    "實驗室的門有電子鎖，需要門禁卡才能打開。",
                    "尋找實驗室中的線索來解開謎題並逃脫。"
                ]
            },
            3: {
                id: 3,
                name: "寶庫密室",
                description: "一個收藏珍貴寶物和藝術品的寶庫，需要細心觀察",
                difficulty: 3,
                icon: "fas fa-gem",
                itemsCount: 6,
                puzzlesCount: 4,
                items: {
                    goldenKey: { id: 'goldenKey', name: '金鑰匙', icon: 'fas fa-key', description: '一把閃閃發光的金鑰匙，看起來非常珍貴。', found: false },
                    treasureMap: { id: 'treasureMap', name: '藏寶圖', icon: 'fas fa-map', description: '一張古老的藏寶圖，上面標記著寶庫中的秘密位置。', found: false },
                    diamond: { id: 'diamond', name: '鑽石', icon: 'fas fa-gem', description: '一顆閃亮的鑽石，看起來價值連城。', found: false },
                    magnifyingGlass: { id: 'magnifyingGlass', name: '放大鏡', icon: 'fas fa-search-plus', description: '一個精緻的放大鏡，可以用來查看細小的線索。', found: false },
                    ancientCoin: { id: 'ancientCoin', name: '古錢幣', icon: 'fas fa-coins', description: '一枚古老的錢幣，上面刻有奇怪的符號。', found: false },
                    codeScroll: { id: 'codeScroll', name: '密碼卷軸', icon: 'fas fa-scroll', description: '一個古老的卷軸，上面寫著數字"3519"。', found: false }
                },
                puzzles: {
                    treasureChest: {
                        id: 'treasureChest',
                        name: '寶箱密碼',
                        instruction: '寶箱需要輸入正確的密碼才能打開。提示：古錢幣上的符號數量。',
                        answer: '3519',
                        solved: false,
                        hint: '仔細查看古錢幣上的符號，數一數每種符號的數量。'
                    },
                    paintingPuzzle: {
                        id: 'paintingPuzzle',
                        name: '畫作謎題',
                        instruction: '這幅畫中隱藏著一個密碼。使用放大鏡查看細節。',
                        answer: 'STAR',
                        solved: false,
                        hint: '畫中的星星排列可能有特殊意義。'
                    },
                    statuePuzzle: {
                        id: 'statuePuzzle',
                        name: '雕像機關',
                        instruction: '雕像的手勢似乎代表某種密碼。',
                        answer: 'GOLD',
                        solved: false,
                        hint: '每個雕像的手指數量可能代表字母表中的位置。'
                    },
                    door: {
                        id: 'door',
                        name: '寶庫大門',
                        instruction: '寶庫的大門需要金鑰匙和密碼才能打開。',
                        answer: 'EXIT',
                        solved: false,
                        hint: '你已經找到所有需要的物品，現在是時候離開了。'
                    }
                },
                roomObjects: [
                    { id: 'treasureChest', name: '寶箱', icon: 'fas fa-chess-board', x: 'chest', puzzle: 'treasureChest' },
                    { id: 'painting', name: '名畫', icon: 'fas fa-image', x: 'painting', puzzle: 'paintingPuzzle' },
                    { id: 'statue', name: '雕像', icon: 'fas fa-monument', x: 'safe', puzzle: 'statuePuzzle' },
                    { id: 'displayCase', name: '展示櫃', icon: 'fas fa-gem', x: 'desk', puzzle: null },
                    { id: 'door', name: '寶庫大門', icon: 'fas fa-door-closed', x: 'door', puzzle: 'door' }
                ],
                initialMessages: [
                    "你被困在一個充滿寶物的寶庫中。",
                    "寶庫的大門非常堅固，需要特殊的鑰匙才能打開。",
                    "尋找寶庫中的線索來解開謎題並帶著寶物逃脫。"
                ]
            },
            4: {
                id: 4,
                name: "時鐘密室",
                description: "一個充滿時鐘和時間謎題的房間，需要時間概念",
                difficulty: 4,
                icon: "fas fa-clock",
                itemsCount: 7,
                puzzlesCount: 5,
                items: {
                    clockHand: { id: 'clockHand', name: '時鐘指針', icon: 'fas fa-clock', description: '一根時鐘的指針，看起來可以安裝在某個時鐘上。', found: false },
                    timeTable: { id: 'timeTable', name: '時間表', icon: 'fas fa-table', description: '一張寫著不同時間的表格。', found: false },
                    sundial: { id: 'sundial', name: '日晷碎片', icon: 'fas fa-sun', description: '一塊古老的日晷碎片。', found: false },
                    pendulum: { id: 'pendulum', name: '鐘擺', icon: 'fas fa-history', description: '一個精緻的鐘擺，可以用來調節時鐘。', found: false },
                    hourglass: { id: 'hourglass', name: '沙漏', icon: 'fas fa-hourglass-half', description: '一個精美的沙漏，沙子流完需要30分鐘。', found: false },
                    watch: { id: 'watch', name: '懷錶', icon: 'fas fa-stopwatch', description: '一枚古老的懷錶，時間停在3:45。', found: false },
                    calendar: { id: 'calendar', name: '日曆', icon: 'fas fa-calendar-alt', description: '一本日曆，上面標記了特殊的日子。', found: false }
                },
                puzzles: {
                    clockPuzzle: {
                        id: 'clockPuzzle',
                        name: '時鐘謎題',
                        instruction: '這個時鐘缺少一根指針。安裝正確的指針後，時鐘顯示的時間就是密碼。',
                        answer: '0345',
                        solved: false,
                        hint: '懷錶上顯示的時間可能是關鍵。'
                    },
                    sundialPuzzle: {
                        id: 'sundialPuzzle',
                        name: '日晷機關',
                        instruction: '日晷需要正確的角度才能投射出陰影顯示密碼。',
                        answer: '1230',
                        solved: false,
                        hint: '中午12點30分的太陽角度是多少？'
                    },
                    pendulumPuzzle: {
                        id: 'pendulumPuzzle',
                        name: '鐘擺頻率',
                        instruction: '調節鐘擺的長度使其與沙漏同步。',
                        answer: '30CM',
                        solved: false,
                        hint: '沙漏的流沙時間是30分鐘，這與鐘擺的長度有關。'
                    },
                    calendarPuzzle: {
                        id: 'calendarPuzzle',
                        name: '日曆密碼',
                        instruction: '根據日曆上標記的特殊日子計算出密碼。',
                        answer: '0721',
                        solved: false,
                        hint: '查看日曆上標記的日期之間的規律。'
                    },
                    door: {
                        id: 'door',
                        name: '時間之門',
                        instruction: '時間之門需要正確的時間序列才能打開。',
                        answer: 'TIME',
                        solved: false,
                        hint: '將所有時間相關的密碼組合起來思考。'
                    }
                },
                roomObjects: [
                    { id: 'grandClock', name: '大時鐘', icon: 'fas fa-clock', x: 'safe', puzzle: 'clockPuzzle' },
                    { id: 'sundialTable', name: '日晷台', icon: 'fas fa-sun', x: 'desk', puzzle: 'sundialPuzzle' },
                    { id: 'pendulumClock', name: '擺鐘', icon: 'fas fa-history', x: 'chest', puzzle: 'pendulumPuzzle' },
                    { id: 'calendarWall', name: '日曆牆', icon: 'fas fa-calendar-alt', x: 'painting', puzzle: 'calendarPuzzle' },
                    { id: 'door', name: '時間之門', icon: 'fas fa-door-closed', x: 'door', puzzle: 'door' }
                ],
                initialMessages: [
                    "你被困在一個充滿時鐘的房間中。",
                    "所有的時鐘都顯示著不同的時間。",
                    "解開時間的謎題才能逃離這個房間。"
                ]
            },
            5: {
                id: 5,
                name: "音樂密室",
                description: "一個充滿樂器和音樂謎題的房間，需要音樂知識",
                difficulty: 4,
                icon: "fas fa-music",
                itemsCount: 7,
                puzzlesCount: 5,
                items: {
                    pianoKey: { id: 'pianoKey', name: '鋼琴鍵', icon: 'fas fa-keyboard', description: '一個鋼琴的白色鍵盤，上面標有音符。', found: false },
                    sheetMusic: { id: 'sheetMusic', name: '樂譜', icon: 'fas fa-file-alt', description: '一張樂譜，上面寫著一段旋律。', found: false },
                    tuningFork: { id: 'tuningFork', name: '音叉', icon: 'fas fa-bell', description: '一個標準A440音叉。', found: false },
                    metronome: { id: 'metronome', name: '節拍器', icon: 'fas fa-tachometer-alt', description: '一個古典節拍器，設定在120BPM。', found: false },
                    violinString: { id: 'violinString', name: '小提琴弦', icon: 'fas fa-guitar', description: '一根小提琴的E弦。', found: false },
                    musicBox: { id: 'musicBox', name: '音樂盒', icon: 'fas fa-compact-disc', description: '一個精緻的音樂盒，需要上發條。', found: false },
                    conductorBaton: { id: 'conductorBaton', name: '指揮棒', icon: 'fas fa-gavel', description: '一根指揮家的指揮棒。', found: false }
                },
                puzzles: {
                    pianoPuzzle: {
                        id: 'pianoPuzzle',
                        name: '鋼琴旋律',
                        instruction: '按照樂譜上的旋律彈奏鋼琴，聽到的音符就是密碼。',
                        answer: 'CDEF',
                        solved: false,
                        hint: '樂譜上的第一個小節是C大調音階。'
                    },
                    tuningPuzzle: {
                        id: 'tuningPuzzle',
                        name: '調音謎題',
                        instruction: '使用音叉調整整套樂器的音高。',
                        answer: 'A440',
                        solved: false,
                        hint: '標準音高是A440Hz。'
                    },
                    rhythmPuzzle: {
                        id: 'rhythmPuzzle',
                        name: '節奏模式',
                        instruction: '按照節拍器的節奏敲擊正確的節奏模式。',
                        answer: '1234',
                        solved: false,
                        hint: '四四拍的節奏模式是什麼？'
                    },
                    musicBoxPuzzle: {
                        id: 'musicBoxPuzzle',
                        name: '音樂盒密碼',
                        instruction: '音樂盒播放的旋律中隱藏著密碼。',
                        answer: 'BACH',
                        solved: false,
                        hint: '注意音樂盒旋律的音符名稱。'
                    },
                    door: {
                        id: 'door',
                        name: '音樂之門',
                        instruction: '音樂之門需要正確的和弦進行才能打開。',
                        answer: 'MELODY',
                        solved: false,
                        hint: '將所有音樂相關的密碼組合起來思考。'
                    }
                },
                roomObjects: [
                    { id: 'piano', name: '鋼琴', icon: 'fas fa-keyboard', x: 'desk', puzzle: 'pianoPuzzle' },
                    { id: 'violin', name: '小提琴', icon: 'fas fa-guitar', x: 'chest', puzzle: 'tuningPuzzle' },
                    { id: 'drums', name: '鼓組', icon: 'fas fa-drum', x: 'safe', puzzle: 'rhythmPuzzle' },
                    { id: 'musicBoxTable', name: '音樂盒桌', icon: 'fas fa-compact-disc', x: 'painting', puzzle: 'musicBoxPuzzle' },
                    { id: 'door', name: '音樂之門', icon: 'fas fa-door-closed', x: 'door', puzzle: 'door' }
                ],
                initialMessages: [
                    "你被困在一個充滿樂器的房間中。",
                    "房間中迴盪著神秘的旋律。",
                    "解開音樂的謎題才能逃離這個房間。"
                ]
            },
            6: {
                id: 6,
                name: "太空密室",
                description: "一個太空站主題的密室，需要科學和邏輯思維",
                difficulty: 5,
                icon: "fas fa-rocket",
                itemsCount: 8,
                puzzlesCount: 6,
                items: {
                    oxygenTank: { id: 'oxygenTank', name: '氧氣罐', icon: 'fas fa-wind', description: '一個充滿氧氣的罐子，還剩80%容量。', found: false },
                    starChart: { id: 'starChart', name: '星圖', icon: 'fas fa-star', description: '一張詳細的星圖，標記了星座位置。', found: false },
                    circuitBoard: { id: 'circuitBoard', name: '電路板', icon: 'fas fa-microchip', description: '一塊複雜的電路板，有幾個零件缺失。', found: false },
                    spaceSuit: { id: 'spaceSuit', name: '太空衣', icon: 'fas fa-user-astronaut', description: '一件完整的太空衣，氧氣供應正常。', found: false },
                    asteroidSample: { id: 'asteroidSample', name: '隕石樣本', icon: 'fas fa-meteor', description: '一塊來自小行星帶的岩石樣本。', found: false },
                    navigationDisk: { id: 'navigationDisk', name: '導航磁碟', icon: 'fas fa-compact-disc', description: '一張存儲太空站導航數據的磁碟。', found: false },
                    laserTool: { id: 'laserTool', name: '雷射工具', icon: 'fas fa-bolt', description: '一個高精度雷射切割工具。', found: false },
                    alienArtifact: { id: 'alienArtifact', name: '外星文物', icon: 'fas fa-jedi', description: '一個神秘的外星文物，表面有發光符號。', found: false }
                },
                puzzles: {
                    oxygenPuzzle: {
                        id: 'oxygenPuzzle',
                        name: '氧氣供應',
                        instruction: '計算氧氣罐還能維持多長時間。提示：太空站有2人，每人每小時消耗5%氧氣。',
                        answer: '8HOURS',
                        solved: false,
                        hint: '80%氧氣，2人每小時消耗10%，能維持多久？'
                    },
                    starPuzzle: {
                        id: 'starPuzzle',
                        name: '星圖座標',
                        instruction: '根據星圖上的星座位置計算出太空站座標。',
                        answer: 'ALPHA7',
                        solved: false,
                        hint: '找到北斗七星和北極星的相對位置。'
                    },
                    circuitPuzzle: {
                        id: 'circuitPuzzle',
                        name: '電路修復',
                        instruction: '修復電路板需要正確連接斷開的線路。',
                        answer: 'CIRCUIT',
                        solved: false,
                        hint: '按照電路板上的顏色順序連接線路。'
                    },
                    navigationPuzzle: {
                        id: 'navigationPuzzle',
                        name: '導航系統',
                        instruction: '輸入正確的座標設定導航系統返回地球。',
                        answer: 'EARTH',
                        solved: false,
                        hint: '地球的座標在太陽系中是第三顆行星。'
                    },
                    laserPuzzle: {
                        id: 'laserPuzzle',
                        name: '雷射切割',
                        instruction: '使用雷射工具切割開擋路的金屬門。',
                        answer: 'DELTA9',
                        solved: false,
                        hint: '隕石樣本上的標記可能是切割模式。'
                    },
                    door: {
                        id: 'door',
                        name: '氣閘門',
                        instruction: '氣閘門需要輸入正確的逃生密碼才能打開。',
                        answer: 'ESCAPE',
                        solved: false,
                        hint: '結合所有太空相關的密碼來找到最終答案。'
                    }
                },
                roomObjects: [
                    { id: 'oxygenPanel', name: '氧氣控制台', icon: 'fas fa-wind', x: 'desk', puzzle: 'oxygenPuzzle' },
                    { id: 'starMap', name: '星圖儀', icon: 'fas fa-star', x: 'painting', puzzle: 'starPuzzle' },
                    { id: 'circuitPanel', name: '電路面板', icon: 'fas fa-microchip', x: 'safe', puzzle: 'circuitPuzzle' },
                    { id: 'navigationConsole', name: '導航控制台', icon: 'fas fa-satellite', x: 'computer', puzzle: 'navigationPuzzle' },
                    { id: 'laserCutter', name: '雷射切割機', icon: 'fas fa-bolt', x: 'chest', puzzle: 'laserPuzzle' },
                    { id: 'door', name: '氣閘門', icon: 'fas fa-door-closed', x: 'door', puzzle: 'door' }
                ],
                initialMessages: [
                    "你被困在一個太空站中。",
                    "氧氣供應有限，必須盡快找到逃脫方法。",
                    "解開太空站的謎題才能返回地球。"
                ]
            }
        };
        
        // 渲染關卡選擇頁面
        function renderLevelSelection() {
            const levelsContainer = document.getElementById('levelsContainer');
            levelsContainer.innerHTML = '';
            
            // 按難度排序關卡
            const sortedLevels = Object.values(levels).sort((a, b) => a.difficulty - b.difficulty);
            
            sortedLevels.forEach(level => {
                const levelCard = document.createElement('div');
                levelCard.className = 'level-card';
                levelCard.dataset.levelId = level.id;
                
                // 創建難度星星
                let starsHtml = '';
                for (let i = 1; i <= 5; i++) {
                    starsHtml += `<i class="star ${i <= level.difficulty ? 'filled' : ''}">★</i>`;
                }
                
                levelCard.innerHTML = `
                    <div class="level-icon">
                        <i class="${level.icon}"></i>
                    </div>
                    <h3 class="level-name">${level.name}</h3>
                    <p class="level-description">${level.description}</p>
                    <div class="level-difficulty">
                        <div class="difficulty-stars">${starsHtml}</div>
                        <div>難度: ${level.difficulty}/5</div>
                    </div>
                    <div class="level-info">
                        <span><i class="fas fa-puzzle-piece"></i> ${level.puzzlesCount} 個謎題</span>
                        <span><i class="fas fa-box-open"></i> ${level.itemsCount} 個物品</span>
                    </div>
                    <button class="play-btn" data-level-id="${level.id}">
                        <i class="fas fa-play"></i> 開始遊戲
                    </button>
                `;
                
                levelsContainer.appendChild(levelCard);
            });
            
            // 添加關卡選擇事件監聽器
            document.querySelectorAll('.play-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const levelId = parseInt(btn.dataset.levelId);
                    startGame(levelId);
                });
            });
            
            // 關卡卡片點擊事件
            document.querySelectorAll('.level-card').forEach(card => {
                card.addEventListener('click', (e) => {
                    if (!e.target.classList.contains('play-btn')) {
                        const levelId = parseInt(card.dataset.levelId);
                        startGame(levelId);
                    }
                });
            });
        }
        
        // 開始遊戲
        function startGame(levelId) {
            gameState.currentLevel = levelId;
            switchPage('gamePage');
            initGame(levelId);
        }
        
        // 切換頁面
        function switchPage(pageId) {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById(pageId).classList.add('active');
        }
        
        // 初始化遊戲
        function initGame(level = 1) {
            // 清除舊的計時器
            if (gameState.timerInterval) {
                clearInterval(gameState.timerInterval);
            }
            
            // 重置遊戲狀態
            gameState = {
                currentLevel: level,
                inventory: [],
                puzzlesSolved: 0,
                itemsFound: 0,
                timeSpent: 0,
                hintsUsed: 0,
                currentPuzzle: null,
                gameActive: true,
                timerInterval: null
            };
            
            // 清空訊息紀錄
            document.getElementById('messageLog').innerHTML = '';
            
            // 初始化訊息紀錄
            const levelData = levels[level];
            levelData.initialMessages.forEach(msg => addMessage(msg, 'system'));
            
            // 更新房間標題
            document.getElementById('roomTitle').textContent = levelData.name;
            
            // 初始化房間
            renderRoom(level);
            
            // 初始化物品欄
            renderInventory(level);
            
            // 更新遊戲狀態顯示
            updateGameStatus();
            
            // 更新提示
            updateHint(level);
            
            // 開始計時
            startTimer();
            
            // 確保逃生訊息是隱藏的
            document.getElementById('escapeMessage').style.display = 'none';
        }
        
        // 渲染房間
        function renderRoom(level) {
            const roomScene = document.getElementById('roomScene');
            roomScene.innerHTML = '';
            
            const levelData = levels[level];
            
            levelData.roomObjects.forEach(obj => {
                const objectDiv = document.createElement('div');
                objectDiv.className = `object ${obj.x}`;
                objectDiv.id = obj.id;
                objectDiv.innerHTML = `
                    <i class="${obj.icon}"></i>
                    <span>${obj.name}</span>
                `;
                
                // 添加點擊事件
                objectDiv.addEventListener('click', () => interactWithObject(obj.id, level));
                
                roomScene.appendChild(objectDiv);
            });
        }
        
        // 渲染物品欄
        function renderInventory(level) {
            const inventory = document.getElementById('inventory');
            inventory.innerHTML = '';
            
            const levelData = levels[level];
            
            // 顯示已找到的物品
            Object.values(levelData.items).forEach(item => {
                if (item.found) {
                    const slot = document.createElement('div');
                    slot.className = 'inventory-slot';
                    slot.id = `slot-${item.id}`;
                    slot.innerHTML = `
                        <i class="${item.icon}"></i>
                        <span>${item.name}</span>
                    `;
                    
                    // 添加點擊事件
                    slot.addEventListener('click', () => useItem(item.id, level));
                    
                    inventory.appendChild(slot);
                }
            });
            
            // 填補空位
            const itemCount = Object.values(levelData.items).filter(item => item.found).length;
            const emptySlots = 8 - itemCount;
            for (let i = 0; i < emptySlots; i++) {
                const slot = document.createElement('div');
                slot.className = 'inventory-slot empty';
                slot.innerHTML = `<i class="fas fa-question"></i><span>空位</span>`;
                inventory.appendChild(slot);
            }
        }
        
        // 與房間物品互動
        function interactWithObject(objectId, level) {
            if (!gameState.gameActive) return;
            
            const levelData = levels[level];
            
            // 根據關卡和物品ID執行不同操作
            // 這裡簡化處理，實際遊戲中需要根據每個關卡的具體邏輯實現
            switch(level) {
                case 1:
                case 2:
                case 3:
                case 4:
                case 5:
                case 6:
                    // 通用互動邏輯
                    handleGenericInteraction(objectId, levelData);
                    break;
            }
            
            renderInventory(level);
            updateGameStatus();
        }
        
        // 通用互動處理
        function handleGenericInteraction(objectId, levelData) {
            // 查找這個物件是否有對應的謎題
            const roomObject = levelData.roomObjects.find(obj => obj.id === objectId);
            
            if (roomObject && roomObject.puzzle) {
                // 如果有謎題，顯示謎題
                const puzzle = levelData.puzzles[roomObject.puzzle];
                if (!puzzle.solved) {
                    showPuzzle(roomObject.puzzle, levelData);
                } else {
                    // 謎題已解決，檢查是否有物品可以獲得
                    const unfoundItems = Object.values(levelData.items).filter(item => !item.found);
                    if (unfoundItems.length > 0) {
                        // 隨機獲得一個物品（實際遊戲中應該有具體邏輯）
                        const randomItem = unfoundItems[Math.floor(Math.random() * unfoundItems.length)];
                        randomItem.found = true;
                        gameState.inventory.push(randomItem.id);
                        addMessage(`你在${roomObject.name}中找到了一個${randomItem.name}。`, 'item');
                        addMessage(randomItem.description, 'system');
                        gameState.itemsFound++;
                    } else {
                        addMessage(`${roomObject.name}已經沒有其他東西了。`, 'system');
                    }
                }
            } else {
                // 沒有謎題的物件，檢查是否有物品可以獲得
                const unfoundItems = Object.values(levelData.items).filter(item => !item.found);
                if (unfoundItems.length > 0) {
                    // 隨機獲得一個物品（實際遊戲中應該有具體邏輯）
                    const randomItem = unfoundItems[Math.floor(Math.random() * unfoundItems.length)];
                    randomItem.found = true;
                    gameState.inventory.push(randomItem.id);
                    addMessage(`你在${roomObject ? roomObject.name : '這裡'}中找到了一個${randomItem.name}。`, 'item');
                    addMessage(randomItem.description, 'system');
                    gameState.itemsFound++;
                } else {
                    addMessage('這裡已經沒有其他東西了。', 'system');
                }
            }
        }
        
        // 顯示謎題
        function showPuzzle(puzzleId, levelData) {
            const puzzle = levelData.puzzles[puzzleId];
            gameState.currentPuzzle = puzzleId;
            
            document.getElementById('puzzleTitle').textContent = puzzle.name;
            document.getElementById('puzzleInstruction').textContent = puzzle.instruction;
            document.getElementById('puzzleInput').value = '';
            
            // 根據謎題類型設置輸入框屬性
            document.getElementById('puzzleInput').placeholder = '輸入答案...';
            document.getElementById('puzzleInput').maxLength = puzzle.answer.length;
            
            document.getElementById('puzzleModal').style.display = 'flex';
            document.getElementById('puzzleInput').focus();
        }
        
        // 使用物品
        function useItem(itemId, level) {
            if (!gameState.gameActive) return;
            
            const levelData = levels[level];
            const item = levelData.items[itemId];
            addMessage(`你使用了${item.name}: ${item.description}`, 'system');
            
            // 特殊物品使用效果
            // 這裡簡化處理，實際遊戲中需要根據每個關卡的具體邏輯實現
            addMessage('這個物品似乎可以在某些地方使用。', 'system');
        }
        
        // 添加訊息到紀錄
        function addMessage(text, type) {
            const messageLog = document.getElementById('messageLog');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            messageDiv.textContent = text;
            
            messageLog.appendChild(messageDiv);
            messageLog.scrollTop = messageLog.scrollHeight;
        }
        
        // 更新遊戲狀態顯示
        function updateGameStatus() {
            const levelData = levels[gameState.currentLevel];
            document.getElementById('puzzlesSolved').textContent = `${gameState.puzzlesSolved}/${levelData.puzzlesCount}`;
            document.getElementById('itemsFound').textContent = `${gameState.itemsFound}/${levelData.itemsCount}`;
        }
        
        // 更新提示
        function updateHint(level) {
            const levelData = levels[level];
            const hintText = document.getElementById('hintText');
            
            if (gameState.currentPuzzle && levelData.puzzles[gameState.currentPuzzle]) {
                hintText.textContent = `當前謎題提示: ${levelData.puzzles[gameState.currentPuzzle].hint}`;
            } else if (gameState.itemsFound < levelData.itemsCount) {
                hintText.textContent = `還有 ${levelData.itemsCount - gameState.itemsFound} 個物品尚未找到。仔細檢查房間中的每個物品。`;
            } else if (gameState.puzzlesSolved < levelData.puzzlesCount) {
                hintText.textContent = `還有 ${levelData.puzzlesCount - gameState.puzzlesSolved} 個謎題尚未解決。使用你找到的物品來解開謎題。`;
            } else {
                hintText.textContent = '你已經找到所有物品並解決了所有謎題！現在可以嘗試逃脫了。';
            }
        }
        
        // 開始計時
        function startTimer() {
            const timerElement = document.getElementById('timeSpent');
            
            gameState.timerInterval = setInterval(() => {
                if (gameState.gameActive) {
                    gameState.timeSpent++;
                    const minutes = Math.floor(gameState.timeSpent / 60);
                    const seconds = gameState.timeSpent % 60;
                    timerElement.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                } else {
                    clearInterval(gameState.timerInterval);
                }
            }, 1000);
        }
        
        // 逃脫房間
        function escapeRoom() {
            if (gameState.gameActive) {
                const levelData = levels[gameState.currentLevel];
                
                if (levelData.puzzles.door && levelData.puzzles.door.solved) {
                    gameState.gameActive = false;
                    
                    // 創建難度星星顯示
                    let starsHtml = '';
                    for (let i = 1; i <= 5; i++) {
                        starsHtml += i <= levelData.difficulty ? '★' : '☆';
                    }
                    
                    // 顯示逃脫成功訊息
                    document.getElementById('finalLevel').textContent = levelData.name;
                    document.getElementById('finalDifficulty').textContent = starsHtml;
                    document.getElementById('finalTime').textContent = document.getElementById('timeSpent').textContent;
                    document.getElementById('finalItems').textContent = gameState.itemsFound;
                    document.getElementById('finalPuzzles').textContent = gameState.puzzlesSolved;
                    document.getElementById('finalHints').textContent = gameState.hintsUsed;
                    document.getElementById('escapeMessage').style.display = 'flex';
                    
                    addMessage(`恭喜！你成功逃離了${levelData.name}！`, 'system');
                }
            }
        }
        
        // 請求提示
        function requestHint() {
            if (!gameState.gameActive) return;
            
            gameState.hintsUsed++;
            
            const levelData = levels[gameState.currentLevel];
            
            if (gameState.currentPuzzle && levelData.puzzles[gameState.currentPuzzle]) {
                const hint = levelData.puzzles[gameState.currentPuzzle].hint;
                addMessage(`提示: ${hint}`, 'system');
                updateHint(gameState.currentLevel);
            } else {
                // 一般提示
                const hints = [
                    '檢查房間中的每個物品，它們可能隱藏著線索或物品。',
                    '有些謎題需要結合多個線索才能解決。',
                    '嘗試使用你找到的物品，它們可能會有特殊用途。',
                    '注意房間中的細節，數字、顏色或圖案都可能是線索。',
                    '如果你卡住了，試著重新檢查已經找到的線索。',
                    '有時解決一個謎題會為你打開新的探索區域。'
                ];
                
                const randomHint = hints[Math.floor(Math.random() * hints.length)];
                addMessage(`提示: ${randomHint}`, 'system');
                updateHint(gameState.currentLevel);
            }
        }
        
        // 檢查房間
        function examineRoom() {
            if (!gameState.gameActive) return;
            
            const levelData = levels[gameState.currentLevel];
            const unsolvedPuzzles = Object.values(levelData.puzzles).filter(p => !p.solved);
            const unfoundItems = Object.values(levelData.items).filter(i => !i.found);
            
            addMessage('你仔細檢查了房間...', 'system');
            
            if (unfoundItems.length > 0) {
                addMessage(`房間中可能還有 ${unfoundItems.length} 個物品尚未找到。`, 'system');
            }
            
            if (unsolvedPuzzles.length > 0) {
                addMessage(`還有 ${unsolvedPuzzles.length} 個謎題尚未解決。`, 'system');
            }
        }
        
        // 嘗試逃脫
        function tryEscape() {
            if (!gameState.gameActive) return;
            
            const levelData = levels[gameState.currentLevel];
            
            if (gameState.puzzlesSolved < levelData.puzzlesCount) {
                addMessage(`門上有複雜的鎖，需要解決所有謎題才能打開。已解決：${gameState.puzzlesSolved}/${levelData.puzzlesCount}`, 'system');
            } else {
                addMessage('你已經解決了所有謎題，現在可以嘗試開門了！', 'system');
                if (levelData.puzzles.door) {
                    showPuzzle('door', levelData);
                } else {
                    // 如果沒有門謎題，直接逃脫
                    escapeRoom();
                }
            }
        }
        
        // 初始化事件監聽器
        function initEventListeners() {
            // 提交謎題答案
            document.getElementById('submitPuzzle').addEventListener('click', () => {
                const puzzleId = gameState.currentPuzzle;
                const levelData = levels[gameState.currentLevel];
                const puzzle = levelData.puzzles[puzzleId];
                const userAnswer = document.getElementById('puzzleInput').value.trim().toUpperCase();
                
                if (userAnswer === puzzle.answer) {
                    // 謎題解決
                    puzzle.solved = true;
                    gameState.puzzlesSolved++;
                    
                    addMessage(`恭喜！你解決了「${puzzle.name}」！`, 'system');
                    
                    // 關閉模態框
                    document.getElementById('puzzleModal').style.display = 'none';
                    
                    // 更新遊戲狀態
                    renderInventory(gameState.currentLevel);
                    updateGameStatus();
                    updateHint(gameState.currentLevel);
                    
                    // 如果解決了門的謎題，自動逃脫
                    if (puzzleId === 'door') {
                        setTimeout(escapeRoom, 1000);
                    }
                } else {
                    addMessage('答案不正確，請再試一次。', 'system');
                }
            });
            
            // 取消謎題
            document.getElementById('cancelPuzzle').addEventListener('click', () => {
                document.getElementById('puzzleModal').style.display = 'none';
            });
            
            // 按Enter提交謎題答案
            document.getElementById('puzzleInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    document.getElementById('submitPuzzle').click();
                }
            });
            
            // 請求提示按鈕
            document.getElementById('hintBtn').addEventListener('click', requestHint);
            
            // 檢查房間按鈕
            document.getElementById('examineBtn').addEventListener('click', examineRoom);
            
            // 嘗試逃脫按鈕
            document.getElementById('escapeBtn').addEventListener('click', tryEscape);
            
            // 重新開始按鈕
            document.getElementById('restartBtn').addEventListener('click', () => {
                document.getElementById('escapeMessage').style.display = 'none';
                initGame(gameState.currentLevel);
            });
            
            // 下一關按鈕
            document.getElementById('nextLevelBtn').addEventListener('click', () => {
                document.getElementById('escapeMessage').style.display = 'none';
                const nextLevel = gameState.currentLevel + 1;
                if (nextLevel <= Object.keys(levels).length) {
                    startGame(nextLevel);
                } else {
                    // 回到第一關
                    switchPage('levelSelectPage');
                    renderLevelSelection();
                }
            });
            
            // 返回關卡選擇按鈕（遊戲中）
            document.getElementById('backToLevelsBtn').addEventListener('click', () => {
                if (confirm('確定要返回關卡選擇嗎？當前遊戲進度將會丟失。')) {
                    switchPage('levelSelectPage');
                    renderLevelSelection();
                }
            });
            
            // 返回關卡選擇按鈕（勝利後）
            document.getElementById('backToLevelsAfterWinBtn').addEventListener('click', () => {
                document.getElementById('escapeMessage').style.display = 'none';
                switchPage('levelSelectPage');
                renderLevelSelection();
            });
        }
        
        // 當頁面加載完成時初始化
        document.addEventListener('DOMContentLoaded', () => {
            renderLevelSelection();
            initEventListeners();
        });
    </script>
</body>
</html>